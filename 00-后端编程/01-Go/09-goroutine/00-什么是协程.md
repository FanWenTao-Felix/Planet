先回顾一下 进程和线程

## 进程

进程拥有代码和打开的文件资源、数据资源、独立的内存空间。

进程进行资源申请的最小单位.

## 线程

线程从属于进程，是程序的实际执行者。 是调度执行的最小单位.

一个进程至少包含一个主线程，也可以有更多的子线程。

线程拥有自己的栈空间

![ZxhU1O.png](https://s2.ax1x.com/2019/07/20/ZxhU1O.png)

归纳：

**对操作系统来说，线程是最小的执行单元，进程是最小的资源管理单元。**

无论进程还是线程，都是由操作系统所管理的。

## 什么是协程

是一种比线程更加轻量级的存在.

正如一个进程可以拥有多个线程一样，一个线程也可以拥有多个协程。

![Zxh64P.png](https://s2.ax1x.com/2019/07/20/Zxh64P.png)

最重要的是，协程不是被操作系统内核所管理，而完全是由程序所控制（也就是在用户态执行）。这样带来的好处就是性能得到了很大的提升，不会像线程切换那样消耗资源。



协程是一种用户态的轻量级线程,  协程的调度完全由用户控制(进程和线程都是由cpu内核进行调度). 协程拥有自己的寄存器上下文和栈. 协程调度切换时, 将寄存器上下文和栈保存到其他地方, 在切回来的时候, 恢复先前保存的寄存器上下文和栈, 直接操作栈基本上没有内核切换的开销, 可以不加锁的访问全局变量, 所以上下文的切换非常快.

对于进程 和线程, 都是有内核进行调度,  有cpu时间片的概念, 进行抢占式调度(有多种调度算法)

对于协程(用户级线程), 就是对内核透明的, 也就是系统并不知道有协程的存在, 完全由用户自己的程序进行调度的, 那么就很难像抢占式调度那样做到强制的CPU控制权切换到其他进程/线程, 通常只能进行 协作式调度, 需要协程自己主动把控制权转让出去之后, 其他协程才能呗执行到.

## 协程是一个线程执行，那怎么利用多核CPU呢

最简单的方法是多进程+协程，既充分利用多核，又充分发挥协程的高效率，可获得极高的性能



## 线程与协程的区别

一个线程可以有多个协程, 一个进程也可以单独拥有多个协程

线程和进程都是同步机制, 而协程是异步

协程能保留上一次调用时的状态, 每次过程重入时, 就相当于进入上一次的调用状态

























