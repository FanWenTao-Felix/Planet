很多时候，我们提倡尽量减小锁的粒度，可以避免不必要的阻塞。 让同步块的作用范围尽可能小，仅在共享数据的实际作用域中才进行同步，如果存在锁竞争，那么等待锁的线程也能尽快拿到锁。

但是如果在一段代码中连续的用同一个监视器锁反复的加锁解锁，甚至加锁操作出现在循环体中的时候，就会导致不必要的性能损耗，这种情况就需要锁粗化。



## 什么是锁粗化?

锁粗化就是将多个连续的加锁、解锁操作连接在一起，扩展成一个范围更大的锁。

```java
for(int i=0;i<100000;i++){
    synchronized(this){
        do();
}
```

会被粗化成：

```java
synchronized(this){
    for(int i=0;i<100000;i++){
        do();
}
```

