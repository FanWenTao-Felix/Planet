## setNX

```php

/**
     * 加锁
     * @param $sKey
     * @param $expTime int 秒
     * @return bool
     */
    public static function bSet($sKey, $expTime)
    {
        $isLock = MControl_Tool_Tool::oRedis()->bSetNX($sKey, time() + $expTime);
        if ($isLock) {
            return true;
        } else {
            //加锁失败的情况下。判断锁是否已经存在，如果锁存在切已经过期，那么删除锁。进行重新加锁

            $val = MControl_Tool_Tool::oRedis()->vGet($sKey);

            if ($val && $val < time()) {
                MControl_Tool_Tool::oRedis()->iDel($sKey);
            }
            return MControl_Tool_Tool::oRedis()->bSetNX($sKey, time() + $expTime);
        }
    }

    /**
     * 删除锁
     * @param $sKey
     */
    public static function vDel($sKey)
    {
        MControl_Tool_Tool::oRedis()->iDel($sKey);
    }

```

## set

需要高版本

```php
public static function set($key, $expTime)
    {
        return self::oRedis()->set($key, time() ,['nx', 'ex' => $expTime]);
}


public static function del($key)
    {
        self::oRedis()->del($key);
    }
```

![](http://ww4.sinaimg.cn/large/006tNc79ly1g3v4s84qi3j31di0oa0yj.jpg)









