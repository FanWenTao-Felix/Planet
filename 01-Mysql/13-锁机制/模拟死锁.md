```sql
 CREATE TABLE `tb` (
  `order_id` int(11) DEFAULT NULL,
  KEY `idx_order_id` (`order_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

insert into tb values(10),(20);
```

![image-20190619191311704](https://s2.ax1x.com/2019/06/19/VXYiTA.png)

当session1执行insert into tb select 15;，session1 已获取到IX锁，gap锁， 等待rec insert intention（插入意向锁）， session1, session2 都在等待插入意向锁， 插入意向锁与gap锁冲突，双方都没有释放gap锁，又都在等待插入意向锁，死锁发生

## 解决方案

1. 修改隔离级别为提交读（RC）
2. 修改业务代码逻辑，删除记录之前，先select，确认该记录存在，再执行delete删除该记录。



