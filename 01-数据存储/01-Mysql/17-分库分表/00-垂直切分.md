单机存储容量、IO、CPU处理能力都有限，当单表的数据量达到1000W或100G以后，库表的增删改查操作面临着性能大幅下降的问题。分库分表是一种解决办法。



## 垂直（纵向）切分

垂直切分常见有垂直分库和垂直分表两种。

### 垂直分库

垂直分库就是根据业务耦合性，将关联度低的不同表存储在不同的数据库。

思想与”微服务治理“类似，将系统拆分为多个业务，每个业务使用自己单独的数据库。比如下图：

![](https://youpaiyun.zongqilive.cn/image/20200226123606.png)

将应用拆分为客户，存款和贷款三个业务，每个业务使用自己单独的数据库。

### 垂直分表

垂直分表是基于数据库中的表字段来进行的。业务中可能存在一些字段比较多的表，表中某些字段长度较大。这些长字段我们又只是偶尔需要用到。这时候我们就可以考虑将表进行垂直拆分了。将某些不常用的，但是长度又很大的字段拎出来放到另外一张表。

MySQL底层是通过数据页存储的，一条记录占用空间过大会导致跨页，造成额外的性能开销。另外数据库以行为单位将数据加载到内存中，这样表中字段长度较短且访问频率较高，内存能加载更多的数据，命中率更高，减少了磁盘IO，从而提升了数据库性能。

![](https://youpaiyun.zongqilive.cn/image/20200226123644.png)

我们将一张包含4个字段的表拆分为2张表，在业务代码里面，通过字段C1来进行关联。



## 垂直切分优缺点

**优点：**

1. 不同系统可以使用不同的库表，解决业务系统层面的耦合，业务清晰

2. 高并发场景下，垂直切分一定程度地提升IO、数据库连接数，缓解单机硬件资源的瓶颈

**缺点：**

1. 部分查询需要在业务代码逻辑里面做聚合，增加开发复杂度

2. 事务处理复杂，可能需要在业务代码层面做处理
3. 不能根本解决单表数据量过大的问题





















## 水平（横向）切分







## 分区类型

### range分区

![](https://youpaiyun.zongqilive.cn/image/006tKfTcly1g1047jesmfj31di0j6424.jpg)

主要用于日期列的分区









## 水平(按行)分表

水平分表策略：

### 按时间分表

这种分表方式有一定的局限性，当数据有较强的实效性，如微博发送记录、微信消息记录等，这种数据很少有用户会查询几个月前的数据，如就可以按月分表。

### 按区间范围分表

一般在有严格的自增id需求上，如按照user_id水平分表：

table_1  user_id从1~100w 

table_2  user_id从101~200w 

table_3  user_id从201~300w 

### hash分表(用的比较多)

通过一个原始目标的ID或者名称通过一定的hash算法计算出数据存储表的表名，然后访问相应的表。







## 垂直(按列)分表

如果一张表中某个字段值非常多(长文本、二进制等)，而且只有在很少的情况下会查询。这时候就可以把字段多个单独放到一个表，通过外键关联起来。 





