当业务难以更细粒度地进行垂直切分，或者切分后单表数据依然过大，存在单库读写、存储性能瓶颈时候，这时候就可以考虑水平切分了。

## 库内分表

库内分表就是在同一个db上，将表按照某种条件拆分为多张表。

比如一张订单表，我们可以依据订单的日期，按月建表。一月份的订单放month_201901这张表，二月份的订单放month_201902这张表。库内分表只解决单表数据量过大问题，但没有将表分布到不同机器上，所有请求还是在一台物理机上竞争cpu，内存，IO，对于减轻mysql负载压力来说帮助不大。



## 分库分表

分库分表就是将表不仅拆分，而且拆分到不同机器上。

可以指定一张表的shardKey，然后对shardKey取hash，根据hash值将数据放到不同的数据库中。这个可以解决单机物理资源的瓶颈问题。

下边示例先根据业务耦合性垂直分库，然后再针对单个库进行分库分表。

![eKsECT.png](https://s2.ax1x.com/2019/07/27/eKsECT.png)

## 分库分表优缺点

**优点：**

1. 不存在单库数据量过大、高并发的性能瓶颈，提升系统稳定性和负载能力

2. 应用端改造较小，不需要拆分业务模块

**缺点：**

1. 跨分片的事务一致性较难保障，一般需要一层中间件，介于业务和db之间。

2. 跨库的join关联查询性能较差













